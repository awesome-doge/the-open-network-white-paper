# 4.3. 訪問 TON Services

我們在 4.1 中討論了可能用於創建駐留在 TON 生態系統中的新服務和應用程式的不同方法。現在我們討論如何訪問這些服務，以及 TON 將提供的一些 “helper services”，包括 TON DNS 和 TON 存儲。

### 4.3.1	TON DNS：主要是鏈上分層功能變數名稱服務。

TON DNS 是一種預定義的服務，它使用一組智慧合約來保存從人類可讀功能變數名稱到 ADNL 網路節點（T6 區塊鏈帳戶和智能合約）的（256 位）位址的映射。
雖然任何人原則上可以使用 TON Blockchain來實現這樣的服務，但是當應用程式或服務想要將人類可讀識別字轉換為位址時，預設情況下使用這種具有眾所周知的介面的預定義服務是有用的。

### 4.3.2	TON DNS 用例。

例如，希望將一些加密貨幣轉移給另一個用戶或商家的用戶，可能更願意記住該用戶或商家的帳戶的 TON DNS 功能變數名稱，而不是複製黏貼他們的 256 位帳戶識別字到輕錢包用戶端的接收者欄位。
類似地，TON DNS 可用于定位智能合約的帳戶識別字或 ton-services 和 ton-sites 的入口點
（參見 4.1.5），從而啟用專用用戶端（“ton-browser”）或通常的互聯網流覽器 結合專門的
TON Proxy 擴展或獨立應用程式，為使用者提供類似 WWW 的流覽體驗。

### 4.3.3	TON DNS 智能合約。

TON DNS 通過特殊（DNS）智慧合約樹實現。 每個 DNS 智慧合約都負責註冊某些固定域的子域。 將保留 TON DNS 系統的第一級域的 “根”DNS 智能合約位於主鏈中。 其帳戶識別字必須硬編碼到希望直接訪問 TON DNS 資料庫的所有軟體中。
任何 DNS 智慧合約都包含一個雜湊圖，將可變長度的以 null 結尾的 UTF-8 字串映射到它們的 “值” 中。 此雜湊圖實現為二進位 Patricia 樹，類似於 2.3.7 中描述的，但支持可變長度位串作為鍵。

### 4.3.4	DNS 雜湊圖或 TON DNS 記錄的值。

至於這些值，它們是由 TL 方案描述的 “TON DNS 記錄”（參見 2.2.5）。它們由一個 “magic number” 組成，選擇一個支援的選項，然後選擇一個帳戶識別字，或一個智慧合約識別字，或一個抽象網路位址（參見 3.1），或一個用於定位抽象位址的公開金鑰服務（參見 3.2.12），或覆蓋網路的描述等等。一個重要的案例是另一個 DNS 智慧合約：在這種情況下，該智慧合約用於解析其域的子域。通過這種方式，可以為不同的域創建單獨的註冊表，由這些域的所有者控制。
這些記錄還可能包含到期時間，緩存時間（通常非常大，因為更新區塊鏈中的值通常是昂貴 的），並且在大多數情況下是對相關子域所有者的引用。所有者有權更改此記錄（特別是所有者欄位，從而將功能變數名稱轉移給其他人的控制權），並延長它。

### 4.3.5	註冊現有域的新子域。

為了註冊現有域的新子域，人們只需向智慧合約發送消息，智慧合約是該域的註冊商，包含要註冊的子域（即金鑰），其中一個是預定義的值之一——由功能變數名稱所有者確定的罰款格式、所有者身份、到期日期和一定數量的加密貨幣。
子功能變數名稱以 “先到先得” 的方式註冊。

### 4.3.6	DNS 智慧合約中檢索資料。

原則上，如果永久存儲內的雜湊值的結構和位置是智慧合約，那麼包含 DNS 智慧合約的主鏈或分片鏈的任何完整節點都可以查找該智慧合約的資料庫中的任何子域。
但這種方法僅適用于某些 DNS 智慧合約。 如果使用非標準 DNS 智慧合約它將會失敗。
相反，使用基於通用智慧合約介面和獲取方法的方法（參見 4.3.11）。 任何 DNS 智慧合約都必須定義帶有 “get method” 的 “known signature”，該方法被調用以查找金鑰。 由於這種方法對其他智慧合約也有意義，特別是那些提供鏈上和混合服務的合同，我們將在 4.3.11 中詳細解釋。

### 4.3.7	TON DNS 域。

一旦任何全節點（單獨或代表某個輕用戶端）可以查找任何 DNS 智慧合約的資料庫中的條目
，就可以從熟悉的的固定根DNS智慧合約（帳戶）識別字開始，任意地翻譯任意 TON DNS
功能變數名稱。
例如，如果想要翻譯 A.B.C，就可以在根域資料庫中查找key .C，.B.C 和 A.B.C。 如果找不到第一個，但第二個找到了，並且其值是對另一個 DNS 智慧合約的引用，則在該智慧合約的資料庫中查找 A 並檢索最終值。

### 4.3.8	為輕節點翻譯 TON DNS 功能變數名稱。

通過這種方式，主鏈的全節點以及功能變數名稱查找過程中涉及的所有分片鏈可以在沒有外部説明的情況下將任何功能變數名稱轉換為其當前值。 輕節點可以請求完整節點代表它執行此操作並返回該值以及 Merkle 證明（參見 2.5.11）。 這種 Merkle 證明將使得工作節點能夠驗證答案是否正確， 因此與通常的 DNS 協議相比，這種 TON DNS 回應不能被惡意攔截器 “spoofed”。
因為沒有節點可以預期是關於所有 shard 鏈的全節點，所以實際的 TON DNS 域轉換將涉及
這兩種策略的組合。

### 4.3.9	專用的 “TON DNS servers”。

簡單的 “TON DNS servers”可以被提供，其將接收 RPC“DNS” 查詢（例如，通過 3.1 中描述的 ADNL 或 RLDP 協議），請求伺服器一個給定功能變數名稱，通過轉發一些來處理這些查詢必要時子查詢到其他（全）節點，並返回原始查詢的答案，如果需要，可以通過 Merkle 證明進行擴充。
這樣的 “DNS 伺服器” 可以使用 4.2 中描述的方法之一向任何其他節點，尤其是輕用戶端提供其服務（免費或收費）。 請注意，如果這些伺服器被認為是 TON DNS servers 的一部分，它將有效地將其從分散式鏈上服務轉換為分散式混合服務（即 “fog service”）。
以上是對 TON DNS 服務的簡要概述，TON DNS 服務是 TON Blockchain和 TON Network 實
體的人類可讀功能變數名稱的可擴展鏈式註冊表。

### 4.3.10	訪問智慧合約中保存的資料。

我們已經看到，有時需要訪問存儲在智慧合約中的資料而不改變其狀態。
如果知道智慧合約實施的細節，就可以從智慧合約的永久性存儲中提取所有需要的資訊，這些資訊可供智慧合約所在的分片鏈的所有全節點使用。但是這是一種非常不優雅的方式，很大程度上取決於智慧合約的執行。

### 4.3.11	“Get methods”。

更好的方法是在智慧合約中定義一些 get method，即某些分片的入站消息在交付時不會影響智慧合約的狀態，但會生成一個或多個包含 “result” 的輸出消息。以這種方式，可以在僅知道智慧合約實現具有已知簽名的 get method（即，要發送的入站消息的已知格式和作為結果要接收的出站消息）時從智慧合約獲得資料。
符合物件導向的程式設計（OOP）的方式更加優雅。但是到目前為止它有一個明顯的缺陷：執行時必須實際將交易提交到區塊鏈中（將獲取消息發送到智慧合約），等待它由驗證人提交和處理，從新的區塊中提取答案，並且支付 gas（即用於在驗證人的硬體上執行 “Get methods”
）。這是一種資源浪費：“Get methods”不會改變智慧合約的狀態，因此不需要在區塊鏈中執
行。

### 4.3.12	智能合約“Get methods”的嘗試性執行。

我們已經談論過（參見 2.4.6）任何全節點都可以暫時執行任何智慧合約的任何方法（即向智慧合約發送任何消息），從智慧合約的給定狀態開始，而不實際提交相應的交易。全節點可以簡單地將所考慮的智慧合約的代碼載入到 TON VM 中，從分片鏈的全域狀態（分片鏈的所有全節點都知悉）初始化其永久存儲，並執行智慧合約代碼。入站消息作為其輸入參數。創建的輸出消息將產生此計算的結果。
這樣，任何全節點都可以評估任意智慧合約的任意get methods，前提是它們的簽名（即入站和出站消息的格式）是已知的。節點可以追蹤在該評估期間訪問的分片鏈狀態的細胞，並創建所執行的計算的有效性的 Merkle 證明，以獲得可能已經要求整個節點這樣做的工作節點（參見 2.5.11）。

### 4.3.13	TL-schemes中的智慧合約介面。

回想一下，智慧合約實現的方法（即它接受的輸入消息）本質上是一些 TL 序列化的物件，可以通過 TL-schemes來描述（參見 2.2.5）。 得到的輸出消息也可以用相同的TL-schemes描述。 通過這種方式，智慧合約提供給其他帳戶和智慧合約的介面可以通過TL-schemes形式化。
特別是，智慧合約支持的 Get methods（的一部分）可以通過這種形式化的智慧合約介面來描述。

### 4.3.14	智慧合約的公共介面。

請注意，形式化的智慧合約介面，無論是 TL-schemes（表示為 TL 原始檔案；參見 2.2.5）還是序列化形式都可以發佈——例如，在特殊領域中 智慧合約帳戶描述，存儲在區塊鏈中，或單獨存儲，如果此介面將被多次引用。 在後一種情況下，支援的公共介面的雜湊可以合併到智慧合約描述中而不是介面描述本身。
這種公共介面的一個例子是 DNS 智慧合約，它應該實現至少一種用於查找子域的標準 Get methods（參見 4.3.6）。 註冊新子域的標準方法也可以包含在 DNS 智慧合約的標準公共介面中。

### 4.3.15	智慧合約的使用者介面。

智慧合約的公共介面的存在也有其他優點。例如，錢包用戶端應用程式可以在根據使用者的請求
檢查智慧合約時下載這樣的介面，並顯示智慧合約支援的公共方法列表（即可用動作的列表）
，可能具有一些在正式版本中提供的人類可讀的評論。

在使用者選擇這些方法之一之後，可以根據 TL-scheme自動生成表單，其中將提示用戶所選方法所需的所有欄位以及所需的加密貨幣量（例如 Grams）附在此請求上。提交此表單將創建一個新的區塊鏈交易，其中包含剛剛撰寫的消息，該消息來自使用者的區塊鏈帳戶。
通過這種方式，只要這些智慧合約已經發佈了他們的介面，使用者就可以通過填寫和提交某些表格，以使用者友好的方式與錢包用戶端應用程式中的任意智慧合約進行交互。

### 4.3.16	ton-service 的使用者介面。

事實證明 “ton-services”（即駐留在 TON Network 中的服務以及通過 ADNL 和 RLDP 協議接受 3 的查詢；參見 4.1.5）也可能從 TL-scheme描述的公共介面中獲益（ 參見 2.2.5）。
用戶端應用程式（例如輕型錢包或 “ton-browser”）可能會提示用戶選擇其中一種方法，並使用介面定義的參數填寫表單，類似於剛剛在 4.3.15 中討論的內容。唯一的區別是生成的
TL-serialized 消息不作為區塊鏈中的交易提交；相反它作為 RPC 查詢被發送到所討論的“ton-service” 的抽象位址，並且根據形式介面（即 TL-scheme）解析和顯示對該查詢的回應。

### 4.3.17	TON DNS 定位使用者介面。

包含 ton 服務的抽象位址或智慧合約帳戶識別字的 TON DNS 記錄還可以包含描述該實體的公共（使用者）介面的可選欄位，或者幾個支援的介面。 然後用戶端應用程式（無論是 wallet， ton-browser 還是 ton-proxy）將能夠以統一的方式下載介面並與相關實體（無論是智慧合約還是一個 ton-service）進行交互。

### 4.3.18	模糊鏈上和鏈下服務之間的區別。

通過這種方式，最終使用者模糊了鏈上、鏈下和混合服務（參見 4.1.2）之間的區別：她只需將所需服務的功能變數名稱輸入到她的ton-browser的位址行或錢包中，其餘部分將由用戶端應用程式無縫處理。

### 4.3.19

TON entity explorer

Telegram

Messenger 用戶端中。
在這一點上出現了一個有趣的機會。 實現上述功能的輕型錢包和 TON 實體流覽器可以嵌入到Telegram Messenger 智慧手機用戶端應用程式中，從而將該技術帶給超過 2 億人。使用者可以通過在消息中包含 TON URIs（參見 4.3.22）來向 TON 實體和資源發送超連結； 如果選擇了這樣的超連結，將由接收方的電報用戶端應用程式在內部打開，並且將開始與所選實體的交互。

### 4.3.20	“ton-sites”

HTTP

ton-services。

ton-site 只是一個支援 HTTP 介面的服務，可能還有其他一些介面。可以在相應的 TON DNS 記錄中宣佈該支援。

### 4.3.21	超連結（Hyperlinks）。

請注意，ton-sites 返回的 HTML 頁面可能包含 ton-hyperlinks-即通過特製 URIs 方案引用其他ton-sites，智慧合約和帳戶參見 4.3.22）——包含摘要網路位址、帳戶識別字或人類可讀的TON DNS 功能變數名稱。 然後，當用戶選擇它時，“ton-browser” 可能會跟隨這樣的超連結，檢測要使用的介面，並顯示 4.3.15 和 4.3.16 中概述的使用者介面表格。

### 4.3.22	URL 可以指定一些參數。

超連結 URL 不僅可以包含（TON）DNS 域或所討論的服務的抽象位址，還可以包含要調用的方法的名稱以及其部分或全部參數。可能的 URI 方案可能如下所示：

ton://<domain>/<method>?<field1>=<value1>&<field2>=. . .

當使用者在 ton-browser 中選擇這樣的連結時，該動作是立即形成（特別是如果它是智慧合約的獲取方法，匿名調用），或顯示部分填寫的表格，由使用者明確確認和提交（這可能是付款表格所必需的）。

### 4.3.23	POST 動作。

一個 ton-sites 可以嵌入到 HTML 頁面中，它返回一些看似常見的 POST 表單，POST 操作通過合適的（TON）URL 引用 ton-sites，ton-services 或智能合約。 在這種情況下，一旦使用者填寫並提交該自訂表單，就會立即或在明確確認後採取相應的操作。

### 4.3.24	TON WWW。

以上內容將説明創建整個網路的交叉引用實體，駐留在 TON Network中，最終用戶可通過噸流覽器訪問該網路，從而為使用者提供類似 WWW 的流覽體驗。 對於最終用戶，這最終將使區塊鏈應用程式與他們已經習慣的網站基本相似。

### 4.3.25	TON WWW 的優點。

這種 “鏈上和鏈下” 服務的 “TON WWW” 與傳統服務相比具有一些優勢。 例如，支付本質上被集成在系統中。 使用者的身份可以始終呈現給服務（通過在交易和生成的 RPC 請求上自動生成的簽名）或隨意隱藏。  服務無需檢查和重新檢查用戶憑據；這些憑證可以一次性發佈在區塊鏈中。使用者網路匿名可以通過 TON 代理輕鬆保存，並且所有服務都將是有效且不可阻止的。小額支付也很容易，因為 ton-browser 可以與 TON 支付系統集成。