# 4.2. 連接用戶和服務提供者

我們在 4.1.9 中已經看到，“fog services”（即混合分散服務）通常需要供給雙方都在的市場， 交易所或註冊管理機構。
這些市場被分為鏈上、鏈下、混合服務、中心化、去中心化等。

### 4.2.1	示例：連接到 TON Payments。

例如，如果想要使用 TON Payments（參見 5），第一步是找到 “lightning network” 的現有的一些傳輸節點（參見 5.2），並與它們建立支付通道。借助於 “encompassing” 覆蓋網路可以找到一些節點，該覆蓋網路應該包含所有傳輸閃電網路節點（參見 3.3.17）。 但目前尚不清楚這些節點是否願意創建新的支付通道。 因此，需要註冊表來讓準備創建新連結的節點發佈它們的聯繫資訊（例如它們的抽象地址）。

### 4.2.2	TON Storage。

類似地，如果想要將檔上傳到 TON Storage，則必須找到一些願意簽署智慧合約的節點， 以綁定它們來保留該檔的副本（或者任何低於特定大小限制的檔）。 因此需要提供用於存儲檔的服務節點的註冊表。

### 4.2.3	鏈上，混合和鏈下註冊管理機構。

這樣的服務提供者註冊表可以完全在鏈上實現，借助智慧合約將註冊表保留在其永久存儲中。然而這將極其緩慢且昂貴。混合方法則更為有效，其中相對較小且很少更改的鏈上註冊表僅用於指出某些節點（通過其抽象地址或其公開金鑰，可用於定位實際的抽象地址，如  3.2.12），提供鏈下（中心化）註冊服務。
最後，分散的純粹的鏈下方法可能包括公共覆蓋網路（參見 3.3），那些願意提供服務的人， 或那些想要購買服務的人，只需通過他們的私密金鑰廣播他們的邀約。如果要提供的服務非常簡單
，甚至可能不需要廣播要約：覆蓋網路本身的近似成員資格可以用作願意提供特定服務的人的“註冊表”。如果已知的節點尚未準備好滿足其需求，需要此服務的用戶端可能會定位（參見3.3.7）並查詢此覆蓋網路的某些節點，然後查詢其鄰近節點。

### 4.2.4	在一個側鏈上的註冊或交易。

實施分散式混合註冊管理機構的另一種方法是創建一個獨立的專業區塊鏈（“側鏈”），由其自己的一套驗證人維護，他們在鏈上智慧合約中發佈其身份並提供網路訪問對這個垂直區塊鏈的所有感興趣的各方，通過專用的覆蓋網路收集交易候選人和廣播區塊更新（參見 3.3）。 然後
，此側鏈的任何完整節點都可以維護自己的共用註冊表副本（基本上等於此側鏈的全域狀態）
，並處理與此註冊表相關的任意查詢。

### 4.2.5	工作鏈中的註冊表或交易。

另一種選擇是在 TON Blockchain 內創建專用工作鏈，專門用於創